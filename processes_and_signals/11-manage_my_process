#!/usr/bin/env bash
# manage_my_process script

start() {
    if [ -f "/var/run/my_process.pid" ] && kill -0 "$(cat /var/run/my_process.pid)" 2>/dev/null; then
        echo "manage_my_process is already running"
        exit 1
    fi

    ./manage_my_process &  
    echo "$!" > /var/run/my_process.pid  

    sleep 1  # Allow process to initialize

    if [ -f "/var/run/my_process.pid" ] && ps -p "$(cat /var/run/my_process.pid)" > /dev/null 2>&1; then
        echo "manage_my_process started successfully"
    else
        echo "Failed to start manage_my_process"
        rm -f /var/run/my_process.pid  
        exit 1
    fi
}

stop() {
    if [ ! -f "/var/run/my_process.pid" ]; then
        echo "manage_my_process is not running"
        exit 1
    fi

    kill "$(cat /var/run/my_process.pid)" 2>/dev/null

    sleep 1  # Wait for the process to terminate

    if ps -p "$(cat /var/run/my_process.pid)" > /dev/null 2>&1; then
        echo "Failed to stop manage_my_process"
        exit 1
    else
        rm -f /var/run/my_process.pid
        echo "manage_my_process stopped successfully"
    fi
}

restart() {
    stop
    start
    echo "manage_my_process restarted"
}

case "$1" in
    start) start ;;
    stop) stop ;;
    restart) restart ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac

